

## 闭包和立即执行函数

### 闭包

#### 什么是闭包

**闭包是指有权访问另一个函数作用域中的变量的函数**

当我们需要隐藏一些不希望被别人访问的内容时就可以使用闭包

#### 闭包利用的原理

函数的词法作用域：在函数创建时就已经确定，和调用的位置无关

#### 构成闭包的要件

1.函数的嵌套

2.内部函数要引用外部函数中的变量

3.内部函数要作为返回值返回

例：

```js
function outer(){
    let num = 0;
    return () => {
        num++;
        console.log(num);
    }
}
```

#### 闭包的作用

1.保护：划分一个独立的代码执行区域，保护自己的私有变量不受外界干扰），保证了内部变量的安全

2.保存：外部函数也可以访问内部函数的变量在内存中维持一个变量，也可以用作缓存

#### 闭包的缺点

1.闭包需要占用一定的内存空间，被引用的内部变量不能被销毁，增大了内存消耗，会导致性能损失，易造成内存泄露

=>可以在内部变量不使用时，把外部的引用置为 null

2.相较于类来说，闭包比较浪费内存空间（类可以使用原型而闭包不能）

=>需要执行次数较少时，使用闭包；需要大量创建实例时，使用类

### 立即执行函数

#### 什么是立即执行函数

**立即执行函数是一个在定义时就会立即执行的函数**

我i们可以利用立即执行函数来创建一个一次性的函数作用域，避免变量冲突的问题

#### 立即执行函数的结构

```js
(function () {
    console.log("立即执行函数")
})();

(function () {
    console.log("立即执行函数")
}())
```

立即执行函数的结构主要包含两部分。第一部分是包围在圆括号运算符里的一个匿名函数，这个匿名函数拥有独立的词法作用域。这不仅避免了外界访问此函数中的变量，而且又不会污染全局作用域。

第二部分再一次使用 `()` 创建了一个立即执行函数表达式，JavaScript 引擎到此将直接执行函数。

### 闭包和立即执行函数的结合使用

将闭包和立即执行函数的作用结合，我们可以得到一个巧妙的结构：其内部的变量不会被外部作用域访问和更改，而只能通过其嵌套的函数（即闭包）访问和更改，我们将该函数作为返回值返回，利用一个立即执行函数接受其返回值，就可以根据需要在外部作用域自由调用这个函数，而不用担心外部作用域的变量对其的影响，形成了一个安全的封闭结构。

=>当我们希望一个变量不会受外部作用域影响，只能被特定函数访问和更改，且需要多次调用该函数时，可以将闭包和立即执行函数的结合使用

例：轮播图的自动切换图片功能实现

```js
const toggleChange = (function () {
    let timer = null;
    return () => {
        if (timer === null) {
            timer = setTimeout(function auto() {
                changeImg("next");
                timer = setTimeout(auto, 3000);
            }, 3000)
        } else {
            clearTimeout(timer);
            timer = null;
        }
    }
}())

toggleChange();
```
